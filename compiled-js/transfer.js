(()=>{"use strict";var t,e,n={970:(t,e,n)=>{n.r(e),n.d(e,{default:()=>o});const o={config:WP_UC_PARAMS}},598:function(t,e,n){var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(l,s){function i(t){try{r(o.next(t))}catch(t){s(t)}}function a(t){try{r(o.throw(t))}catch(t){s(t)}}function r(t){var e;t.done?l(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}r((o=o.apply(t,e||[])).next())}))},l=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=l(n(970));class i{constructor(t="uc-upload",e="uc-download"){this.uploadButtons=document.querySelectorAll('button[data-action="uc-upload"]'),this.downloadButtons=document.querySelectorAll('button[data-action="uc-download"]'),this.uploadAllButton=document.getElementById("uploadAll"),this.downloadAllButton=document.getElementById("downloadAll"),this.progressBarWrapper=null,this.progressBar=null,this.uploadBtnSelector="uc-upload",this.downloadBtnSelector="uc-download",this.isDoingRequest=!1,this.bu=t=>{t.preventDefault(),t.returnValue="",delete t.returnValue},this.config=s.default.config,null!==t&&(this.uploadBtnSelector=t),null!==e&&(this.downloadBtnSelector=e),this.downloadButtons=i.getNodeList(`button[data-action="${this.downloadBtnSelector}"]`),this.uploadButtons=i.getNodeList(`button[data-action="${this.uploadBtnSelector}"]`),this.progressBarWrapper=document.getElementById("transferProgress"),this.progressBarWrapper instanceof HTMLDivElement&&(this.progressBar=this.progressBarWrapper.querySelector("div")),this.addActions()}addBeforeUnload(){window.addEventListener("beforeunload",this.bu)}removeBeforeUnload(){window.removeEventListener("beforeunload",this.bu)}checkLocalExists(){const t=i.getNodeList(`button[data-action="${this.uploadBtnSelector}"]`);return Array.prototype.slice.call(t).filter((t=>"none"!==t.style.display)).length>0}checkExternalExists(){const t=i.getNodeList(`button[data-action="${this.downloadBtnSelector}"]`);return Array.prototype.slice.call(t).filter((t=>"none"!==t.style.display)).length>0}static getNodeList(t){return document.querySelectorAll(t)}addActions(){this.uploadButtons.forEach((t=>{t.addEventListener("click",(t=>{this.uploadAction(t)}))})),this.downloadButtons.forEach((t=>{t.addEventListener("click",(t=>{this.downloadAction(t)}))})),this.toggleTransferAllAction(),this.toggleDownloadAllAction()}toggleTransferAllAction(){if(null===this.uploadAllButton)return;const t=document.getElementById("linkBack");if(this.checkLocalExists())this.uploadAllButton.removeAttribute("disabled"),this.uploadAllButton.addEventListener("click",(t=>{this.uploadAllAction(t).then((()=>{this.uploadAllButton instanceof HTMLButtonElement&&this.toggleTransferAllAction()}))})),this.uploadAllButton.style.display="inline-block",t instanceof HTMLElement&&(t.style.display="none");else{this.uploadAllButton.setAttribute("disabled","1");const e=this.uploadAllButton.dataset;e.hasOwnProperty("linkBack")&&null!=e.linkBack&&(this.uploadAllButton.style.display="none",t instanceof HTMLElement&&(t.style.display="inline-block"))}}toggleDownloadAllAction(){null!==this.downloadAllButton&&(this.checkExternalExists()?(this.downloadAllButton.removeAttribute("disabled"),this.downloadAllButton.addEventListener("click",(t=>{this.downloadAllAction(t).then((()=>{this.downloadAllButton instanceof HTMLButtonElement&&this.toggleDownloadAllAction()}))})),this.downloadAllButton.style.display="inline-block"):this.downloadAllButton.setAttribute("disabled","1"))}makeFormData(t){const e=new FormData;return t.forEach((t=>{e.append(t.property,t.value)})),e}uploadAllAction(t){return o(this,void 0,void 0,(function*(){const e=t.currentTarget;if(!(e instanceof HTMLButtonElement))return;t.preventDefault();const n=[];Array.prototype.slice.call(this.uploadButtons).forEach((t=>{const e=t.dataset.post||!1;!1!==e&&((t.dataset.uuid||"").length>0||n.push(parseInt(e)))}));const o=this.makeFormData([{property:"action",value:"uploadcare_upload_multiply"},{property:"nonce",value:this.config.nonce||""},{property:"posts",value:n}]);return yield this.fetchAction(o,e),Promise.resolve()}))}downloadAllAction(t){return o(this,void 0,void 0,(function*(){const e=t.currentTarget;if(!(e instanceof HTMLButtonElement))return;t.preventDefault();const n=[];Array.prototype.slice.call(this.downloadButtons).forEach((t=>{const e=t.dataset.post||!1;!1!==e&&0!==(t.dataset.uuid||"").length&&n.push(parseInt(e))}));const o=this.makeFormData([{property:"action",value:"uploadcare_download_multiply"},{property:"posts",value:n}]);return yield this.fetchAction(o,e),Promise.resolve()}))}uploadAction(t){t.preventDefault();const e=t.currentTarget;if(!(e instanceof HTMLButtonElement))return;const n=this.makeFormData([{property:"action",value:"uploadcare_transfer"},{property:"nonce",value:this.config.nonce||""},{property:"postId",value:e.dataset.post||""}]);this.fetchAction(n,e)}downloadAction(t){t.preventDefault();const e=t.currentTarget;if(!(e instanceof HTMLButtonElement))return;const n=this.makeFormData([{property:"action",value:"uploadcare_down"},{property:"uuid",value:e.dataset.uuid||""},{property:"postId",value:e.dataset.post||""},{property:"nonce",value:this.config.nonce||""}]);this.fetchAction(n,e)}setProgress(t){null===t&&(t=100),this.progressBar instanceof HTMLDivElement&&(this.progressBar.style.width=`${t}%`)}fetchAction(t,e){if(this.isDoingRequest)return;this.isDoingRequest=!0,this.addBeforeUnload(),this.setProgress(null),e.setAttribute("disabled","1");const n=e.innerHTML;e.innerHTML='<div class="spinner-border spinner-border-sm" role="status"></div>',this.isDoingRequest=!0,this.disableActionButtons(),window.fetch(this.config.ajaxurl,{method:"POST",redirect:"follow",body:t,headers:{Accept:"application/json"}}).then((t=>{if(this.isDoingRequest=!1,200!==t.status)throw t.text();return t.json()})).then((t=>{t.hasOwnProperty("fileUrl")&&this.changeAttributes(t),t instanceof Array&&t.forEach((t=>this.changeAttributes(t))),this.isDoingRequest=!1})).catch((t=>{t instanceof Promise?t.then((t=>{i.showError(t)})):console.error(t),this.isDoingRequest=!1,this.setProgress(0)})).finally((()=>{this.removeBeforeUnload(),e.innerHTML=n,this.uploadAllButton instanceof HTMLButtonElement&&this.toggleTransferAllAction(),this.downloadAllButton instanceof HTMLButtonElement&&this.toggleDownloadAllAction(),this.isDoingRequest=!1}))}changeAttributes(t){if(!t.hasOwnProperty("fileUrl")||!t.hasOwnProperty("postId"))return;const e=t.hasOwnProperty("uploadcare_uuid")?t.uploadcare_uuid:"",n=document.getElementById(`uc-download-${t.postId}`)||document.createElement("button");"string"==typeof e&&e.length>0?n.dataset.uuid=e:n.dataset.uuid="",i.setAttributes(t.postId,t.fileUrl),this.setProgress(0),this.uploadAllButton instanceof HTMLButtonElement&&this.toggleTransferAllAction()}disableActionButtons(){this.uploadAllButton instanceof HTMLButtonElement&&this.uploadAllButton.setAttribute("disabled","1"),this.downloadAllButton instanceof HTMLButtonElement&&this.downloadAllButton.setAttribute("disabled","1")}static showError(t){const e=document.getElementById("uc-error-place");e instanceof HTMLElement&&(e.innerText=t,e.classList.remove("hidden"),window.scrollTo(0,0))}static setAttributes(t,e){if(null===t)return;const n=document.getElementById(`image-${t}`);n instanceof Image&&n.setAttribute("src",e);const o=i.getUploadButton(t),l=i.getDownloadBtn(t),s=i.getTransferredIcon(t),a=i.getNotTransferredIcon(t);null!==o&&(o.disabled=!1,"none"===o.style.display?o.style.display="inline-block":o.style.display="none"),null!==l&&(l.disabled=!1,"none"===l.style.display?l.style.display="inline-block":l.style.display="none"),s instanceof HTMLElement&&(s.classList.contains("hidden")?s.classList.remove("hidden"):s.classList.add("hidden")),a instanceof HTMLElement&&(a.classList.contains("hidden")?a.classList.remove("hidden"):a.classList.add("hidden"))}static getTransferredIcon(t){return document.getElementById(`icon-transferred-${t}`)}static getNotTransferredIcon(t){return document.getElementById(`icon-not-transferred-${t}`)}static getDownloadBtn(t){const e=document.getElementById(`uc-download-${t}`);return e instanceof HTMLButtonElement?e:null}static getUploadButton(t){const e=document.getElementById(`uc-upload-${t}`);return e instanceof HTMLButtonElement?e:null}}e.default=i}},o={};function l(t){var e=o[t];if(void 0!==e)return e.exports;var s=o[t]={exports:{}};return n[t].call(s.exports,s,s.exports,l),s.exports}l.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return l.d(e,{a:e}),e},l.d=(t,e)=>{for(var n in e)l.o(e,n)&&!l.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},l.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),l.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},t=l(598),e=l.n(t),document.addEventListener("DOMContentLoaded",(()=>{new(e())}))})();